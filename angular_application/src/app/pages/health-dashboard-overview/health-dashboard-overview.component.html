<a class="skip-link" href="#main">Skip to main content</a>

<section class="hd-header bg-white rounded-xl shadow-sm border border-slate-100 px-4 py-3 mb-6 flex items-center justify-between">
  <div class="hd-header__left flex items-center gap-3">
    <h1 id="page-title" class="hd-title font-bold text-[clamp(18px,2vw,22px)]">Welcome, {{ username }}!</h1>
  </div>
  <nav class="hd-header__actions flex items-center gap-2" aria-label="Header actions">
    <button pButton type="button" class="p-button-text px-3 py-2 rounded-md border border-slate-200" aria-label="Notifications">•</button>
    <button pButton type="button" class="p-button px-3 py-2 rounded-md text-white" style="background:#2563EB;border-color:#2563EB">New Report</button>
  </nav>
</section>

<main id="main" class="hd-main grid gap-6" role="main">
  <!-- Overview -->
  <section class="hd-overview bg-white rounded-xl shadow-sm border border-slate-100 p-6">
    <div class="hd-section__header flex items-center justify-between gap-4 flex-wrap">
      <h2 id="overview-heading" class="hd-h2 font-semibold text-[clamp(16px,1.6vw,20px)]">Overview</h2>

      <div class="hd-filters flex gap-2 flex-wrap" role="group" aria-label="Overview filters">
        <p-dropdown
          [options]="deviceOptions"
          optionLabel="label"
          optionValue="value"
          [ngModel]="filters().device"
          (onChange)="updateFilter('device', $event.value)"
          [style]="{minWidth:'12rem'}"
          [showClear]="false"
          placeholder="Device"
        ></p-dropdown>
        <p-dropdown
          [options]="periodOptions"
          optionLabel="label"
          optionValue="value"
          [ngModel]="filters().period"
          (onChange)="updateFilter('period', $event.value)"
          [style]="{minWidth:'10rem'}"
          [showClear]="false"
          placeholder="Period"
        ></p-dropdown>
        <p-dropdown
          [options]="regionOptions"
          optionLabel="label"
          optionValue="value"
          [ngModel]="filters().region"
          (onChange)="updateFilter('region', $event.value)"
          [style]="{minWidth:'10rem'}"
          [showClear]="false"
          placeholder="Region"
        ></p-dropdown>
      </div>
    </div>

    <ul class="hd-metrics grid grid-cols-1 md:grid-cols-3 gap-4 mt-6" role="list">
      <li
        *ngFor="let m of metrics(); trackBy: trackByIndex"
        class="metric-card p-4 grid gap-1 rounded-lg border"
        [ngClass]="{
          'ok border-emerald-300/60': m.tone === 'ok',
          'warn border-amber-300/60': m.tone === 'warn',
          'error border-rose-300/60': m.tone === 'error'
        }"
        [attr.aria-label]="m.key + ' ' + m.value"
      >
        <div class="metric-card__label text-sm text-slate-500">{{ m.key }}</div>
        <div class="metric-card__value font-bold text-[clamp(18px,2vw,24px)]">{{ m.value }}</div>
      </li>
    </ul>
  </section>

  <!-- Device Distribution -->
  <section class="hd-distribution bg-white rounded-xl shadow-sm border border-slate-100 p-6">
    <h2 id="distribution-heading" class="hd-h2 font-semibold text-[clamp(16px,1.6vw,20px)]">Device Distribution</h2>

    <div class="hd-distribution__strip grid grid-cols-1 md:grid-cols-3 gap-4 mt-4" role="group" aria-label="Distribution by status">
      <div *ngFor="let d of distribution(); trackBy: trackByIndex"
           class="strip-cell rounded-lg px-3 py-2 flex items-center justify-between border"
           [ngClass]="{
              'ok bg-emerald-50 text-emerald-800 border-emerald-100': d.tone === 'ok',
              'warn bg-amber-50 text-amber-800 border-amber-100': d.tone === 'warn',
              'error bg-rose-50 text-rose-800 border-rose-100': d.tone === 'error'
            }">
        <span class="strip-cell__label font-semibold">{{ d.key }}</span>
        <span class="strip-cell__value font-bold">{{ d.value }}</span>
      </div>
    </div>

    <div class="hd-panels grid grid-cols-1 xl:grid-cols-2 gap-6 mt-6">
      <!-- KPI image panel mapped from asset -->
      <article class="panel panel--table rounded-xl border border-slate-100 shadow-sm overflow-hidden" aria-labelledby="panel-table-heading">
        <header class="panel__header flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <h3 id="panel-table-heading" class="hd-h3 font-semibold text-[clamp(14px,1.4vw,18px)]">KPI Snapshot (Last 30d)</h3>
        </header>
        <div class="panel__body p-4">
          <img
            src="assets/figma_image_525_35699_509_10095.png"
            alt="KPI cards grid visualization"
            class="panel__image w-full h-auto rounded-lg"
            width="1200" height="320"
            decoding="async" loading="eager"
          />
        </div>
      </article>

      <!-- Chart using ng-apexcharts -->
      <article class="panel panel--chart rounded-xl border border-slate-100 shadow-sm overflow-hidden" aria-labelledby="panel-chart-heading">
        <header class="panel__header flex items-center justify-between px-4 py-3 border-b border-slate-100">
          <h3 id="panel-chart-heading" class="hd-h3 font-semibold text-[clamp(14px,1.4vw,18px)]">Trend</h3>
          <div aria-hidden="true" class="panel__legend flex gap-3 text-xs text-slate-500">
            <span class="dot ok inline-block w-2 h-2 rounded-full bg-emerald-500 mr-1"></span> Healthy
            <span class="dot warn inline-block w-2 h-2 rounded-full bg-amber-500 mr-1"></span> Warning
            <span class="dot error inline-block w-2 h-2 rounded-full bg-rose-500 mr-1"></span> Anomaly
          </div>
        </header>
        <div class="panel__body p-4">
          <apx-chart
            [series]="chartSeries"
            [chart]="chartOptions.chart"
            [dataLabels]="chartOptions.dataLabels"
            [stroke]="chartOptions.stroke"
            [xaxis]="chartOptions.xaxis"
            [yaxis]="chartOptions.yaxis"
            [legend]="chartOptions.legend"
            [fill]="chartOptions.fill"
            [grid]="chartOptions.grid"
            [markers]="chartOptions.markers"
            [tooltip]="chartOptions.tooltip"
            [colors]="chartOptions.colors"
          ></apx-chart>
        </div>
      </article>
    </div>
  </section>

  <!-- Table -->
  <section class="hd-table bg-white rounded-xl shadow-sm border border-slate-100 p-6">
    <h2 id="table-heading" class="hd-h2 font-semibold text-[clamp(16px,1.6vw,20px)] mb-4">Device Table</h2>

    <div class="table-wrapper rounded-lg overflow-hidden border border-slate-100">
      <table style="min-width:40rem;">
        <thead>
          <tr>
            <th scope="col">Device</th>
            <th scope="col">Location</th>
            <th scope="col">Status</th>
            <th scope="col">Last Seen</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of devices(); trackBy: trackByIndex">
            <td>{{ row.id }}</td>
            <td>{{ row.location }}</td>
            <td>
              <p-tag
                [value]="row.status"
                [severity]="row.status === 'Healthy' ? 'success' : (row.status === 'Warning' ? 'warning' : 'danger')"
              ></p-tag>
            </td>
            <td>{{ row.seen }}</td>
            <td>
              <button pButton type="button" class="p-button-outlined px-2 py-1 rounded-md">View</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <footer class="hd-footer text-slate-500 text-sm">
    <small>© 2025 Health Dashboard</small>
  </footer>
</main>
