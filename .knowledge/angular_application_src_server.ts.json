{"is_source_file": true, "format": "TypeScript", "description": "This file is a server-side script for an Angular Universal (SSR) application using Express. It sets up an HTTP server, defines API endpoints (notably for integrating with Figma), and handles rendering Angular pages. It also includes logic for environment setup and static file serving.", "external_files": ["@angular/common", "@angular/ssr/node", "express", "node:path", "node:url", "./main.server", "node-fetch", "abort-controller"], "external_methods": ["express.json", "express.static", "app.use", "app.post", "app.get", "commonEngine.render", "isMainModule"], "published": ["app"], "classes": [], "methods": [{"name": "ensureServerFetch", "description": "Ensures that global fetch and AbortController are available in the Node SSR environment, importing 'node-fetch' and 'abort-controller' dynamically if necessary."}], "calls": ["app.use", "app.post", "app.get", "commonEngine.render", "isMainModule", "import"], "search-terms": ["Angular SSR server", "Express API route", "Figma import handler", "public rendering middleware", "environment setup", "static file serving"], "state": 2, "file_id": 16, "knowledge_revision": 52, "git_revision": "e4cf3d94858d7ca40d910c1587c940928148813c", "revision_history": [{"41": "e4cf3d94858d7ca40d910c1587c940928148813c"}, {"42": "e4cf3d94858d7ca40d910c1587c940928148813c"}, {"52": "e4cf3d94858d7ca40d910c1587c940928148813c"}], "ctags": [{"_type": "tag", "name": "ac", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      const ac = await import('abort-controller');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "accessToken", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const { fileKey, accessToken } = req.body ?? {};$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "allowOutbound", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const allowOutbound = (process.env['NG_APP_FEATURE_FLAGS'] || '').includes('allowFigmaOutbou/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const app = express();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseUrl", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "browserDistFolder", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const browserDistFolder = resolve(serverDistFolder, '..\\/browser');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "commonEngine", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const commonEngine = new CommonEngine();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "controller", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^        const controller = new (globalThis as any).AbortController();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ensureServerFetch", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const ensureServerFetch = async () => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "env", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      env: process.env['NG_APP_NODE_ENV'] || process.env['NODE_ENV'] || 'production',$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const errors: string[] = [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fileKey", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      fileKey,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fileKey", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const { fileKey, accessToken } = req.body ?? {};$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "g", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const g: any = globalThis as any;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "indexHtml", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const indexHtml = join(serverDistFolder, 'index.server.html');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "mod", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const mod = await import('node-fetch');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "nodeEnv", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const nodeEnv = process.env['NG_APP_NODE_ENV'] || process.env['NODE_ENV'] || 'production';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "originalUrl", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "port", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const port = process.env['PORT'] || 4000;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "projectId", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const projectId = (req.query['project_id'] ?? '').toString().trim();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "protocol", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "requestId", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const requestId = Math.random().toString(36).slice(2, 10);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resp", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^        const resp = await (globalThis as any).fetch(`https:\\/\\/api.figma.com\\/v1\\/files\\/${enco/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "responsePayload", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const responsePayload = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "serverDistFolder", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const serverDistFolder = dirname(fileURLToPath(import.meta.url));$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^          let t = '';$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "timeout", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^        const timeout = setTimeout(() => controller.abort(), 3500);$/", "language": "TypeScript", "kind": "constant"}], "hash": "8a25eaa2cf2a083f9865f237ad2a3595", "format-version": 4, "code-base-name": "angular_application", "filename": "angular_application/src/server.ts", "fields": [{"name": "let t = '';", "scope": "", "scopeKind": "", "description": "unavailable"}]}