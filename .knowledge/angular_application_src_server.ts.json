{"is_source_file": true, "format": "TypeScript", "description": "Server-side setup for an Angular application with Express, including API routes for Figma data processing, static file serving, and SSR rendering logic.", "external_files": ["@angular/common", "@angular/ssr/node", "express", "node:path", "node:url", "./main.server"], "external_methods": ["isMainModule", "createRequire"], "published": ["app"], "classes": [], "methods": [{"name": "app.post('/api/figma/add_figma_data')", "description": "API endpoint for processing incoming Figma import requests, performing validation, and optionally verifying file access via Figma's API."}, {"name": "app.get('**')", "description": "Serves static files from the browser distribution folder with long cache duration."}, {"name": "app.get('**')", "description": "Catch-all route for rendering the Angular application server-side using Angular Universal's CommonEngine."}, {"name": "isMainModule", "description": "Utility to determine if the current module is the main entry point for the application."}], "calls": ["commonEngine.render", "app.listen", "globalThis.fetch", "globalThis.AbortController", "createRequire"], "search-terms": ["Server-side Angular", "Express API Figma", "SSR node fetch", "Angular Universal server", "Figma API validation"], "state": 2, "file_id": 16, "knowledge_revision": 89, "git_revision": "e1252b71ba43334be58bba6364ba23a86747c0c3", "revision_history": [{"41": "e4cf3d94858d7ca40d910c1587c940928148813c"}, {"42": "e4cf3d94858d7ca40d910c1587c940928148813c"}, {"52": "e4cf3d94858d7ca40d910c1587c940928148813c"}, {"57": "4dffd0a2cd7e1777553270636c8b198102f381f2"}, {"62": "4dffd0a2cd7e1777553270636c8b198102f381f2"}, {"63": "4dffd0a2cd7e1777553270636c8b198102f381f2"}, {"64": "4dffd0a2cd7e1777553270636c8b198102f381f2"}, {"65": "4dffd0a2cd7e1777553270636c8b198102f381f2"}, {"66": "e1252b71ba43334be58bba6364ba23a86747c0c3"}, {"89": "e1252b71ba43334be58bba6364ba23a86747c0c3"}], "ctags": [{"_type": "tag", "name": "acMod", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      const acMod: any = (() => { try { return require('abort-controller'); } catch { return nul/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "accessToken", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const { fileKey, accessToken } = req.body ?? {};$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "allowOutbound", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const allowOutbound = (process.env['NG_APP_FEATURE_FLAGS'] || '').includes('allowFigmaOutbou/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const app = express();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "baseUrl", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "browserDistFolder", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const browserDistFolder = resolve(serverDistFolder, '..\\/browser');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "commonEngine", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const commonEngine = new CommonEngine();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "controller", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^        const controller = new (globalThis as any).AbortController();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ensureServerFetch", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const ensureServerFetch = async () => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "env", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      env: process.env['NG_APP_NODE_ENV'] || process.env['NODE_ENV'] || 'production',$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const errors: string[] = [];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fileKey", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      fileKey,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fileKey", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const { fileKey, accessToken } = req.body ?? {};$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "g", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const g: any = globalThis as any;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "healthPath", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const healthPath = process.env['NG_APP_HEALTHCHECK_PATH'] || '\\/healthz';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "host", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const host = '0.0.0.0';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "indexHtml", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const indexHtml = join(serverDistFolder, 'index.server.html');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "mod", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      const mod: any = (() => { try { return require('node-fetch'); } catch { return null; } })(/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "nodeEnv", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const nodeEnv = process.env['NG_APP_NODE_ENV'] || process.env['NODE_ENV'] || 'production';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "originalUrl", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "parseInt", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const port = typeof portRaw === 'string' ? parseInt(portRaw as string, 10) || 3001 : (portRaw /", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "port", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const port = typeof portRaw === 'string' ? parseInt(portRaw as string, 10) || 3001 : (portRaw /", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "portRaw", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const portRaw = process.env['PORT'] || process.env['NG_APP_PORT'] || '3001';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "projectId", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const projectId = (req.query['project_id'] ?? '').toString().trim();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "protocol", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const { protocol, originalUrl, baseUrl, headers } = req;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "requestId", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^  const requestId = Math.random().toString(36).slice(2, 10);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "require", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^      const require = createRequire(import.meta.url);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "resp", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^        const resp = await (globalThis as any).fetch(`https:\\/\\/api.figma.com\\/v1\\/files\\/${enco/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "responsePayload", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^    const responsePayload = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "serverDistFolder", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^const serverDistFolder = dirname(fileURLToPath(import.meta.url));$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^          let t = '';$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "timeout", "path": "/home/kavia/workspace/code-generation/angular-reusable-component-library-integration-36-45/angular_application/src/server.ts", "pattern": "/^        const timeout = (globalThis as any).setTimeout ? (globalThis as any).setTimeout(() => co/", "language": "TypeScript", "kind": "constant"}], "hash": "c34d2a3ab22ff0b89512f79791b40e3c", "format-version": 4, "code-base-name": "angular_application", "filename": "angular_application/src/server.ts", "fields": [{"name": "let t = '';", "scope": "", "scopeKind": "", "description": "unavailable"}]}